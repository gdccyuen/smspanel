{% extends "base.html" %}

{% block title %}Compose SMS - SMS Application{% endblock %}

{% block content %}
<div class="compose">
    <h1>Compose SMS</h1>
    <form method="POST" class="compose-form">
        <div class="form-group">
            <label for="enquiry_number">Enquiry Number</label>
            <input
                type="text"
                id="enquiry_number"
                name="enquiry_number"
                required
                placeholder="1234 5678"
                value="{{ enquiry_number }}"
            >
            <small>Format: 4 digits, optional space, 4 digits (e.g., 1234 5678 or 12345678)</small>
        </div>
        <div class="form-group">
            <label for="recipients">Recipients</label>
            <textarea
                id="recipients"
                name="recipients"
                rows="4"
                required
                placeholder="Enter phone numbers (one per line)&#10;Example:&#10;1234 5678&#10;12345678"
            >{{ recipients }}</textarea>
            <small>Enter one phone number per line. Format: 4 digits, optional space, 4 digits (e.g., 1234 5678 or 12345678)</small>
        </div>
        <div class="form-group">
            <label for="content">Message</label>
            <textarea
                id="content"
                name="content"
                rows="4"
                required
                placeholder="Enter your message here..."
            >{{ content }}</textarea>
            <small id="char-count">0 characters</small>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Send SMS</button>
            <a href="{{ url_for('web.web_sms.dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
    const contentTextarea = document.getElementById('content');
    const enquiryNumberInput = document.getElementById('enquiry_number');
    const charCount = document.getElementById('char-count');

    function updateCharCount() {
        const contentLen = contentTextarea.value.length;
        const enquiryLen = enquiryNumberInput.value.length;
        const totalLen = contentLen > 0 || enquiryLen > 0 ? contentLen + 4 + enquiryLen : 0; // " EN:" prefix = 4 chars
        charCount.textContent = totalLen + ' characters (SMS)';
    }

    contentTextarea.addEventListener('input', updateCharCount);
    enquiryNumberInput.addEventListener('input', updateCharCount);
</script>
{% endblock %}
